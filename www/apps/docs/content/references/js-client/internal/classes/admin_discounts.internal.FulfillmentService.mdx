---
displayed_sidebar: jsClientSidebar
---

import ParameterTypes from "@site/src/components/ParameterTypes"

# FulfillmentService

[admin/discounts](../../modules/admin_discounts.mdx).[internal](../../admin_discounts/modules/admin_discounts.internal.mdx).FulfillmentService

Handles Fulfillments

## Properties

<ParameterTypes parameters={[
  {
    "name": "__configModule__",
    "type": "Record<`string`, `unknown`\\>",
    "description": "",
    "optional": true,
    "defaultValue": "",
    "children": []
  },
  {
    "name": "__container__",
    "type": "`any`",
    "description": "",
    "optional": false,
    "defaultValue": "",
    "children": []
  },
  {
    "name": "__moduleDeclaration__",
    "type": "Record<`string`, `unknown`\\>",
    "description": "",
    "optional": true,
    "defaultValue": "",
    "children": []
  },
  {
    "name": "fulfillmentProviderService_",
    "type": "[`FulfillmentProviderService`](admin_discounts.internal.internal.FulfillmentProviderService.mdx)",
    "description": "",
    "optional": false,
    "defaultValue": "",
    "children": []
  },
  {
    "name": "fulfillmentRepository_",
    "type": "`Repository`<[`Fulfillment`](admin_collections.internal.Fulfillment.mdx)\\>",
    "description": "",
    "optional": false,
    "defaultValue": "",
    "children": []
  },
  {
    "name": "lineItemRepository_",
    "type": "`Repository`<[`LineItem`](admin_collections.internal.LineItem.mdx)\\> & { `findByReturn`: Method findByReturn  }",
    "description": "",
    "optional": false,
    "defaultValue": "",
    "children": []
  },
  {
    "name": "lineItemService_",
    "type": "[`LineItemService`](admin_discounts.internal.internal.LineItemService.mdx)",
    "description": "",
    "optional": false,
    "defaultValue": "",
    "children": []
  },
  {
    "name": "manager_",
    "type": "`EntityManager`",
    "description": "",
    "optional": false,
    "defaultValue": "",
    "children": []
  },
  {
    "name": "productVariantInventoryService_",
    "type": "[`ProductVariantInventoryService`](admin_discounts.internal.internal.ProductVariantInventoryService.mdx)",
    "description": "",
    "optional": false,
    "defaultValue": "",
    "children": []
  },
  {
    "name": "shippingProfileService_",
    "type": "[`ShippingProfileService`](admin_discounts.internal.internal.ShippingProfileService.mdx)",
    "description": "",
    "optional": false,
    "defaultValue": "",
    "children": []
  },
  {
    "name": "totalsService_",
    "type": "[`TotalsService`](admin_discounts.internal.internal.TotalsService.mdx)",
    "description": "",
    "optional": false,
    "defaultValue": "",
    "children": []
  },
  {
    "name": "trackingLinkRepository_",
    "type": "`Repository`<[`TrackingLink`](admin_collections.internal.TrackingLink.mdx)\\>",
    "description": "",
    "optional": false,
    "defaultValue": "",
    "children": []
  },
  {
    "name": "transactionManager_",
    "type": "`undefined` \\| `EntityManager`",
    "description": "",
    "optional": false,
    "defaultValue": "",
    "children": []
  }
]} />

## Accessors

### activeManager\_

`Protected` `get` **activeManager_**(): `EntityManager`

#### Returns

`EntityManager`

<ParameterTypes parameters={[
  {
    "name": "EntityManager",
    "type": "`EntityManager`",
    "optional": false,
    "defaultValue": "",
    "description": "",
    "children": []
  }
]} />

#### Inherited from

TransactionBaseService.activeManager\_

## Methods

### atomicPhase\_

`Protected` **atomicPhase_**<`TResult`, `TError`\>(`work`, `isolationOrErrorHandler?`, `maybeErrorHandlerOrDontFail?`): `Promise`<`TResult`\>

Wraps some work within a transactional block. If the service already has
a transaction manager attached this will be reused, otherwise a new
transaction manager is created.

<ParameterTypes parameters={[
  {
    "name": "TResult",
    "type": "`object`",
    "description": "",
    "optional": false,
    "defaultValue": "",
    "children": []
  },
  {
    "name": "TError",
    "type": "`object`",
    "description": "",
    "optional": false,
    "defaultValue": "",
    "children": []
  }
]} />

#### Parameters

<ParameterTypes parameters={[
  {
    "name": "work",
    "type": "(`transactionManager`: `EntityManager`) => `Promise`<`TResult`\\>",
    "description": "the transactional work to be done",
    "optional": false,
    "defaultValue": "",
    "children": []
  },
  {
    "name": "isolationOrErrorHandler",
    "type": "`IsolationLevel` \\| (`error`: `TError`) => `Promise`<`void` \\| `TResult`\\>",
    "description": "the isolation level to be used for the work.",
    "optional": true,
    "defaultValue": "",
    "children": []
  },
  {
    "name": "maybeErrorHandlerOrDontFail",
    "type": "(`error`: `TError`) => `Promise`<`void` \\| `TResult`\\>",
    "description": "Potential error handler",
    "optional": true,
    "defaultValue": "",
    "children": []
  }
]} />

#### Returns

`Promise`<`TResult`\>

<ParameterTypes parameters={[
  {
    "name": "Promise",
    "type": "`Promise`<`TResult`\\>",
    "optional": false,
    "defaultValue": "",
    "description": "the result of the transactional work",
    "children": []
  }
]} />

#### Inherited from

[TransactionBaseService](admin_discounts.internal.internal.TransactionBaseService.mdx).[atomicPhase_](admin_discounts.internal.internal.TransactionBaseService.mdx#atomicphase_)

___

### cancelFulfillment

**cancelFulfillment**(`fulfillmentOrId`): `Promise`<[`Fulfillment`](admin_collections.internal.Fulfillment.mdx)\>

Cancels a fulfillment with the fulfillment provider. Will decrement the
fulfillment_quantity on the line items associated with the fulfillment.
Throws if the fulfillment has already been shipped.

#### Parameters

<ParameterTypes parameters={[
  {
    "name": "fulfillmentOrId",
    "type": "`string` \\| [`Fulfillment`](admin_collections.internal.Fulfillment.mdx)",
    "description": "the fulfillment object or id.",
    "optional": false,
    "defaultValue": "",
    "children": []
  }
]} />

#### Returns

`Promise`<[`Fulfillment`](admin_collections.internal.Fulfillment.mdx)\>

<ParameterTypes parameters={[
  {
    "name": "Promise",
    "type": "`Promise`<[`Fulfillment`](admin_collections.internal.Fulfillment.mdx)\\>",
    "optional": false,
    "defaultValue": "",
    "description": "the result of the save operation",
    "children": [
      {
        "name": "Fulfillment",
        "type": "[`Fulfillment`](admin_collections.internal.Fulfillment.mdx)",
        "optional": false,
        "defaultValue": "",
        "description": "",
        "children": []
      }
    ]
  }
]} />

___

### createFulfillment

**createFulfillment**(`order`, `itemsToFulfill`, `custom?`): `Promise`<[`Fulfillment`](admin_collections.internal.Fulfillment.mdx)[]\>

Creates an order fulfillment
If items needs to be fulfilled by different provider, we make
sure to partition those items, and create fulfillment for
those partitions.

#### Parameters

<ParameterTypes parameters={[
  {
    "name": "order",
    "type": "[`CreateFulfillmentOrder`](../../admin_discounts/modules/admin_discounts.internal.mdx#createfulfillmentorder)",
    "description": "order to create fulfillment for",
    "optional": false,
    "defaultValue": "",
    "children": []
  },
  {
    "name": "itemsToFulfill",
    "type": "[`FulFillmentItemType`](../../admin_discounts/modules/admin_discounts.internal.mdx#fulfillmentitemtype)[]",
    "description": "the items in the order to fulfill",
    "optional": false,
    "defaultValue": "",
    "children": []
  },
  {
    "name": "custom",
    "type": "[`Partial`](../../admin_discounts/modules/admin_discounts.internal.mdx#partial)<[`Fulfillment`](admin_collections.internal.Fulfillment.mdx)\\>",
    "description": "potential custom values to add",
    "optional": true,
    "defaultValue": "",
    "children": []
  }
]} />

#### Returns

`Promise`<[`Fulfillment`](admin_collections.internal.Fulfillment.mdx)[]\>

<ParameterTypes parameters={[
  {
    "name": "Promise",
    "type": "`Promise`<[`Fulfillment`](admin_collections.internal.Fulfillment.mdx)[]\\>",
    "optional": false,
    "defaultValue": "",
    "description": "the created fulfillments",
    "children": [
      {
        "name": "Fulfillment[]",
        "type": "[`Fulfillment`](admin_collections.internal.Fulfillment.mdx)[]",
        "optional": false,
        "defaultValue": "",
        "description": "",
        "children": [
          {
            "name": "Fulfillment",
            "type": "[`Fulfillment`](admin_collections.internal.Fulfillment.mdx)",
            "optional": false,
            "defaultValue": "",
            "description": "",
            "children": []
          }
        ]
      }
    ]
  }
]} />

___

### createShipment

**createShipment**(`fulfillmentId`, `trackingLinks?`, `config?`): `Promise`<[`Fulfillment`](admin_collections.internal.Fulfillment.mdx)\>

Creates a shipment by marking a fulfillment as shipped. Adds
tracking links and potentially more metadata.

#### Parameters

<ParameterTypes parameters={[
  {
    "name": "fulfillmentId",
    "type": "`string`",
    "description": "the fulfillment to ship",
    "optional": false,
    "defaultValue": "",
    "children": []
  },
  {
    "name": "trackingLinks",
    "type": "{ `tracking_number`: `string`  }[]",
    "description": "tracking links for the shipment",
    "optional": true,
    "defaultValue": "",
    "children": []
  },
  {
    "name": "config",
    "type": "[`CreateShipmentConfig`](../../admin_discounts/modules/admin_discounts.internal.mdx#createshipmentconfig)",
    "description": "potential configuration settings, such as no_notification and metadata",
    "optional": true,
    "defaultValue": "",
    "children": []
  }
]} />

#### Returns

`Promise`<[`Fulfillment`](admin_collections.internal.Fulfillment.mdx)\>

<ParameterTypes parameters={[
  {
    "name": "Promise",
    "type": "`Promise`<[`Fulfillment`](admin_collections.internal.Fulfillment.mdx)\\>",
    "optional": false,
    "defaultValue": "",
    "description": "the shipped fulfillment",
    "children": [
      {
        "name": "Fulfillment",
        "type": "[`Fulfillment`](admin_collections.internal.Fulfillment.mdx)",
        "optional": false,
        "defaultValue": "",
        "description": "",
        "children": []
      }
    ]
  }
]} />

___

### getFulfillmentItems\_

**getFulfillmentItems_**(`order`, `items`): `Promise`<(``null`` \| [`LineItem`](admin_collections.internal.LineItem.mdx))[]\>

Retrieves the order line items, given an array of items.

#### Parameters

<ParameterTypes parameters={[
  {
    "name": "order",
    "type": "[`CreateFulfillmentOrder`](../../admin_discounts/modules/admin_discounts.internal.mdx#createfulfillmentorder)",
    "description": "the order to get line items from",
    "optional": false,
    "defaultValue": "",
    "children": []
  },
  {
    "name": "items",
    "type": "[`FulFillmentItemType`](../../admin_discounts/modules/admin_discounts.internal.mdx#fulfillmentitemtype)[]",
    "description": "the items to get",
    "optional": false,
    "defaultValue": "",
    "children": []
  }
]} />

#### Returns

`Promise`<(``null`` \| [`LineItem`](admin_collections.internal.LineItem.mdx))[]\>

<ParameterTypes parameters={[
  {
    "name": "Promise",
    "type": "`Promise`<(``null`` \\| [`LineItem`](admin_collections.internal.LineItem.mdx))[]\\>",
    "optional": false,
    "defaultValue": "",
    "description": "the line items generated by the transformer.",
    "children": [
      {
        "name": "(``null`` \\| LineItem)[]",
        "type": "(``null`` \\| [`LineItem`](admin_collections.internal.LineItem.mdx))[]",
        "optional": false,
        "defaultValue": "",
        "description": "",
        "children": [
          {
            "name": "``null`` \\| LineItem",
            "type": "``null`` \\| [`LineItem`](admin_collections.internal.LineItem.mdx)",
            "optional": true,
            "defaultValue": "",
            "description": "",
            "children": []
          }
        ]
      }
    ]
  }
]} />

___

### partitionItems\_

**partitionItems_**(`shippingMethods`, `items`): [`FulfillmentItemPartition`](../../admin_discounts/modules/admin_discounts.internal.mdx#fulfillmentitempartition)[]

#### Parameters

<ParameterTypes parameters={[
  {
    "name": "shippingMethods",
    "type": "[`ShippingMethod`](admin_collections.internal.ShippingMethod.mdx)[]",
    "description": "",
    "optional": false,
    "defaultValue": "",
    "children": []
  },
  {
    "name": "items",
    "type": "[`LineItem`](admin_collections.internal.LineItem.mdx)[]",
    "description": "",
    "optional": false,
    "defaultValue": "",
    "children": []
  }
]} />

#### Returns

[`FulfillmentItemPartition`](../../admin_discounts/modules/admin_discounts.internal.mdx#fulfillmentitempartition)[]

<ParameterTypes parameters={[
  {
    "name": "FulfillmentItemPartition[]",
    "type": "[`FulfillmentItemPartition`](../../admin_discounts/modules/admin_discounts.internal.mdx#fulfillmentitempartition)[]",
    "optional": false,
    "defaultValue": "",
    "description": "",
    "children": [
      {
        "name": "FulfillmentItemPartition",
        "type": "`object`",
        "description": "",
        "optional": false,
        "defaultValue": "",
        "children": []
      }
    ]
  }
]} />

___

### retrieve

**retrieve**(`fulfillmentId`, `config?`): `Promise`<[`Fulfillment`](admin_collections.internal.Fulfillment.mdx)\>

Retrieves a fulfillment by its id.

#### Parameters

<ParameterTypes parameters={[
  {
    "name": "fulfillmentId",
    "type": "`string`",
    "description": "the id of the fulfillment to retrieve",
    "optional": false,
    "defaultValue": "",
    "children": []
  },
  {
    "name": "config",
    "type": "[`FindConfig`](../interfaces/admin_discounts.internal.internal.FindConfig.mdx)<[`Fulfillment`](admin_collections.internal.Fulfillment.mdx)\\>",
    "description": "optional values to include with fulfillmentRepository query",
    "optional": true,
    "defaultValue": "",
    "children": []
  }
]} />

#### Returns

`Promise`<[`Fulfillment`](admin_collections.internal.Fulfillment.mdx)\>

<ParameterTypes parameters={[
  {
    "name": "Promise",
    "type": "`Promise`<[`Fulfillment`](admin_collections.internal.Fulfillment.mdx)\\>",
    "optional": false,
    "defaultValue": "",
    "description": "the fulfillment",
    "children": [
      {
        "name": "Fulfillment",
        "type": "[`Fulfillment`](admin_collections.internal.Fulfillment.mdx)",
        "optional": false,
        "defaultValue": "",
        "description": "",
        "children": []
      }
    ]
  }
]} />

___

### shouldRetryTransaction\_

`Protected` **shouldRetryTransaction_**(`err`): `boolean`

#### Parameters

<ParameterTypes parameters={[
  {
    "name": "err",
    "type": "Record<`string`, `unknown`\\> \\| { `code`: `string`  }",
    "description": "",
    "optional": false,
    "defaultValue": "",
    "children": []
  }
]} />

#### Returns

`boolean`

<ParameterTypes parameters={[
  {
    "name": "boolean",
    "type": "`boolean`",
    "optional": true,
    "defaultValue": "",
    "description": "",
    "children": []
  }
]} />

#### Inherited from

[TransactionBaseService](admin_discounts.internal.internal.TransactionBaseService.mdx).[shouldRetryTransaction_](admin_discounts.internal.internal.TransactionBaseService.mdx#shouldretrytransaction_)

___

### validateFulfillmentLineItem\_

**validateFulfillmentLineItem_**(`item`, `quantity`): ``null`` \| [`LineItem`](admin_collections.internal.LineItem.mdx)

Checks that a given quantity of a line item can be fulfilled. Fails if the
fulfillable quantity is lower than the requested fulfillment quantity.
Fulfillable quantity is calculated by subtracting the already fulfilled
quantity from the quantity that was originally purchased.

#### Parameters

<ParameterTypes parameters={[
  {
    "name": "item",
    "type": "`undefined` \\| [`LineItem`](admin_collections.internal.LineItem.mdx)",
    "description": "the line item to check has sufficient fulfillable quantity.",
    "optional": false,
    "defaultValue": "",
    "children": []
  },
  {
    "name": "quantity",
    "type": "`number`",
    "description": "the quantity that is requested to be fulfilled.",
    "optional": false,
    "defaultValue": "",
    "children": []
  }
]} />

#### Returns

``null`` \| [`LineItem`](admin_collections.internal.LineItem.mdx)

<ParameterTypes parameters={[
  {
    "name": "``null`` \\| LineItem",
    "type": "``null`` \\| [`LineItem`](admin_collections.internal.LineItem.mdx)",
    "optional": true,
    "defaultValue": "",
    "description": "a line item that has the requested fulfillment quantity\n  set.",
    "children": []
  }
]} />

___

### withTransaction

**withTransaction**(`transactionManager?`): [`FulfillmentService`](admin_discounts.internal.FulfillmentService.mdx)

#### Parameters

<ParameterTypes parameters={[
  {
    "name": "transactionManager",
    "type": "`EntityManager`",
    "description": "",
    "optional": true,
    "defaultValue": "",
    "children": []
  }
]} />

#### Returns

[`FulfillmentService`](admin_discounts.internal.FulfillmentService.mdx)

<ParameterTypes parameters={[
  {
    "name": "FulfillmentService",
    "type": "[`FulfillmentService`](admin_discounts.internal.FulfillmentService.mdx)",
    "optional": false,
    "defaultValue": "",
    "description": "",
    "children": []
  }
]} />

#### Inherited from

[TransactionBaseService](admin_discounts.internal.internal.TransactionBaseService.mdx).[withTransaction](admin_discounts.internal.internal.TransactionBaseService.mdx#withtransaction)

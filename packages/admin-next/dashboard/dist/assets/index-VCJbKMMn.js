import{a as G,u as E,j as e,T as p,a6 as Ge,a7 as Xe,bQ as ge,a4 as We,bm as Je,aA as Ye,bR as Ke}from"./index-S--WvUSo.js";import{u as es,a as W}from"./route-focus-modal-MMx5Xnk0.js";import{t as ss}from"./zod-jt04JUtm.js";import{r as b}from"./react-PzSkSLoa.js";import{F as t,a as ts,H as rs,u as is,c as Ne}from"./form-0PHaH8g8.js";import{j as je,b as ns}from"./react-router-dom-aSYyayiN.js";import{S as J}from"./split-view-l-bJVVse.js";import{g as De,c as M,a as F}from"./money-amount-helpers--myf8Rla.js";import{c as O}from"./cast-number-oeIUIgsb.js";import{z as o}from"./index-JzuMwgWW.js";import{D as k}from"./divider-GiVPCNCn.js";import{C as K}from"./conditional-tooltip-KJH4b1Z4.js";import{H as se}from"./heading-cSlef4Su.js";import{L as Y}from"./label-HFq5fzpT.js";import{C as ne}from"./checkbox-8MlXzZCx.js";import{I as w}from"./input-A29ux7yj.js";import{S as T}from"./select-Z4sV_-wF.js";import{u as Te}from"./useInfiniteQuery-20kl54mv.js";import{l as as}from"./lodash-5s15_I2H.js";import{C as ke}from"./combobox-DjjFlb75.js";import{A as Se}from"./action-menu-olZwXQ3q.js";import{T as Me}from"./thumbnail-gerN888-.js";import{T as Ie}from"./trash-nTjeUaCp.js";import{C as ae}from"./currency-input-k1bgGOuE.js";import{B as V}from"./button-Pc5Xo8ua.js";import{d as ls}from"./debounce-tjgneXZ5.js";import{a as os,D as cs}from"./use-data-table-TeZp00wg.js";import{M as ds}from"./money-amount-cell-qk7EOos5.js";import{P as we}from"./placeholder-cell-O6UVTGmQ.js";import{a as ms}from"./product-cell-gRltbXZC.js";import{u as us,a as xs}from"./use-variant-table-filters-UuBTNphG.js";import{c as hs}from"./index-JDlOzmVl.js";import{g as Ee}from"./addresses-d8YOe6mI.js";import{S as ps}from"./switch-VR1xZXYU.js";import{C as fs}from"./copy-jbaNBJoS.js";import{P as R}from"./progress-tabs-S8wsVeqQ.js";import"./react-dom-Og6--24v.js";import"./drawer-H3TI1lDZ.js";import"./index-sF0hA49A.js";import"./prompt-LzbVPZYR.js";import"./information-circle-solid-rXH6vJ5W.js";import"./tooltip-Ixyw9oT8.js";import"./currencies-bd3ADI6s.js";import"./index-Hm2Uj9Gg.js";import"./triangles-mini-HukRlWGp.js";import"./x-mark-mini-aYDSd38M.js";import"./plus-mini-IRJECoWI.js";import"./empty-table-content-i72rBIA2.js";import"./index-1Zwdg31z.js";import"./use-date-Putn0_Ur.js";import"./format-vrL-wy9v.js";import"./date-picker-s8-9mila.js";import"./minus-E5-czcFC.js";import"./index-7dV3TD85.js";import"./command-bar-wUgfUfvQ.js";import"./countries-QR_y0WJ_.js";import"./check-circle-solid-7j4QonPK.js";const Oe=o.object({first_name:o.string().min(1),last_name:o.string().min(1),address_1:o.string().min(1),address_2:o.string().optional(),city:o.string().min(1),province:o.string().optional(),postal_code:o.string().min(1),country_code:o.string().min(1),phone:o.string().optional(),company:o.string().optional()}),gs=o.object({product_title:o.string().optional(),thumbnail:o.string().optional(),variant_title:o.string().optional(),variant_id:o.string().min(1),sku:o.string().optional(),quantity:o.number().min(1),unit_price:o.number().min(0),custom_unit_price:o.union([o.number(),o.string()]).optional()}).superRefine((s,r)=>{s.custom_unit_price&&isNaN(O(s.custom_unit_price))&&r.addIssue({code:o.ZodIssueCode.custom,message:"Invalid custom unit price",path:["custom_unit_price"]})}),Ve=o.object({title:o.string().min(1),quantity:o.number().min(1),unit_price:o.union([o.number(),o.string()])}).superRefine((s,r)=>{typeof s.unit_price=="string"&&isNaN(O(s.unit_price))&&r.addIssue({code:o.ZodIssueCode.custom,message:"Invalid unit price",path:["unit_price"]})}),js=o.object({option_id:o.string().min(1),option_title:o.string(),amount:o.union([o.number(),o.string()]).optional(),custom_amount:o.union([o.number(),o.string()]).optional()}).superRefine((s,r)=>{s.custom_amount&&isNaN(O(s.custom_amount))&&r.addIssue({code:o.ZodIssueCode.custom,message:"Invalid custom amount",path:["custom_amount"]})}),bs=o.object({email:o.string().optional(),region_id:o.string().min(1),customer_id:o.string().optional(),shipping_address:Oe,billing_address:Oe.nullable(),existing_items:o.array(gs).optional(),custom_items:o.array(Ve).optional(),shipping_method:js,notification_order:o.boolean().optional()}).superRefine((s,r)=>{var n,l;!((n=s.existing_items)!=null&&n.length)&&!((l=s.custom_items)!=null&&l.length)&&(r.addIssue({code:o.ZodIssueCode.custom,message:G.t("draftOrders.validation.requiredItems"),path:["custom_items"]}),r.addIssue({code:o.ZodIssueCode.custom,message:G.t("draftOrders.validation.requiredItems"),path:["existing_items"]})),!s.email&&!s.customer_id?(r.addIssue({code:o.ZodIssueCode.custom,message:G.t("draftOrders.validation.requiredEmailOrCustomer"),path:["customer_id"]}),r.addIssue({code:o.ZodIssueCode.custom,message:G.t("draftOrders.validation.requiredEmailOrCustomer"),path:["email"]})):!s.customer_id&&s.email&&(o.string().email().safeParse(s.email).success||r.addIssue({code:o.ZodIssueCode.custom,message:G.t("draftOrders.validation.invalidEmail"),path:["email"]}))});var ee=(s=>(s.EXISTING_ITEMS="existing_items",s.CUSTOM_ITEMS="custom_items",s))(ee||{});const Fe=b.createContext(null),z=()=>{const s=b.useContext(Fe);if(!s)throw new Error("useCreateDraftOrder must be used within a CreateDraftOrderProvider");return s},vs=()=>{const{t:s}=E(),{form:r,region:n,sameAsShipping:l,setSameAsShipping:i}=z();return e.jsxs("div",{className:"flex flex-col gap-y-8",children:[e.jsxs("div",{className:"flex flex-col gap-y-4",children:[e.jsx(se,{level:"h2",children:s("fields.address")}),e.jsx(p,{size:"small",leading:"compact",weight:"plus",children:s("addresses.shippingAddress.label")}),e.jsx(ze,{field:"shipping_address",region:n,control:r.control})]}),e.jsxs("div",{className:"flex flex-col gap-y-4",children:[e.jsxs("div",{className:"flex flex-col gap-y-2",children:[e.jsx(p,{size:"small",leading:"compact",weight:"plus",children:s("addresses.billingAddress.label")}),e.jsxs(Y,{className:"flex cursor-pointer items-center gap-x-2",children:[e.jsx(ne,{checked:l,onCheckedChange:m=>i(m===!0)}),s("addresses.billingAddress.sameAsShipping")]})]}),e.jsx(Ge,{open:!l,children:e.jsx(Xe,{children:e.jsx(ze,{field:"billing_address",region:n,control:r.control})})})]})]})},ze=({field:s,control:r,region:n})=>{const{t:l}=E();return e.jsxs("fieldset",{className:"flex flex-col gap-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(t.Field,{control:r,name:`${s}.first_name`,render:({field:i})=>e.jsxs(t.Item,{children:[e.jsx(t.Label,{className:"text-ui-fg-subtle font-normal",children:l("fields.firstName")}),e.jsx(t.Control,{children:e.jsx(w,{...i})}),e.jsx(t.ErrorMessage,{})]})}),e.jsx(t.Field,{control:r,name:`${s}.last_name`,render:({field:i})=>e.jsxs(t.Item,{children:[e.jsx(t.Label,{className:"text-ui-fg-subtle font-normal",children:l("fields.lastName")}),e.jsx(t.Control,{children:e.jsx(w,{...i})}),e.jsx(t.ErrorMessage,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(t.Field,{control:r,name:`${s}.company`,render:({field:i})=>e.jsxs(t.Item,{children:[e.jsx(t.Label,{optional:!0,className:"text-ui-fg-subtle font-normal",children:l("fields.company")}),e.jsx(t.Control,{children:e.jsx(w,{...i})}),e.jsx(t.ErrorMessage,{})]})}),e.jsx(t.Field,{control:r,name:`${s}.phone`,render:({field:i})=>e.jsxs(t.Item,{children:[e.jsx(t.Label,{optional:!0,className:"text-ui-fg-subtle font-normal",children:l("fields.phone")}),e.jsx(t.Control,{children:e.jsx(w,{...i})}),e.jsx(t.ErrorMessage,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(t.Field,{control:r,name:`${s}.address_1`,render:({field:i})=>e.jsxs(t.Item,{children:[e.jsx(t.Label,{className:"text-ui-fg-subtle font-normal",children:l("fields.address")}),e.jsx(t.Control,{children:e.jsx(w,{...i})}),e.jsx(t.ErrorMessage,{})]})}),e.jsx(t.Field,{control:r,name:`${s}.address_2`,render:({field:i})=>e.jsxs(t.Item,{children:[e.jsx(t.Label,{optional:!0,className:"text-ui-fg-subtle font-normal",children:l("fields.address2")}),e.jsx(t.Control,{children:e.jsx(w,{...i})}),e.jsx(t.ErrorMessage,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(t.Field,{control:r,name:`${s}.city`,render:({field:i})=>e.jsxs(t.Item,{children:[e.jsx(t.Label,{className:"text-ui-fg-subtle font-normal",children:l("fields.city")}),e.jsx(t.Control,{children:e.jsx(w,{...i})}),e.jsx(t.ErrorMessage,{})]})}),e.jsx(t.Field,{control:r,name:`${s}.postal_code`,render:({field:i})=>e.jsxs(t.Item,{children:[e.jsx(t.Label,{className:"text-ui-fg-subtle font-normal",children:l("fields.postalCode")}),e.jsx(t.Control,{children:e.jsx(w,{...i})}),e.jsx(t.ErrorMessage,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(t.Field,{control:r,name:`${s}.province`,render:({field:i})=>e.jsxs(t.Item,{children:[e.jsx(t.Label,{optional:!0,className:"text-ui-fg-subtle font-normal",children:l("fields.province")}),e.jsx(t.Control,{children:e.jsx(w,{...i})}),e.jsx(t.ErrorMessage,{})]})}),e.jsx(t.Field,{control:r,name:`${s}.country_code`,render:({field:{onChange:i,ref:m,disabled:a,...g},fieldState:{error:u}})=>e.jsx(K,{showTooltip:!n,content:l("draftOrders.create.chooseRegionTooltip"),children:e.jsxs(t.Item,{children:[e.jsx(t.Label,{className:"text-ui-fg-subtle font-normal",children:l("fields.country")}),e.jsx(t.Control,{children:e.jsxs(T,{disabled:!n||a,onValueChange:i,...g,children:[e.jsx(T.Trigger,{"aria-invalid":!!u,ref:m,children:e.jsx(T.Value,{})}),e.jsx(T.Content,{children:n==null?void 0:n.countries.map(d=>e.jsx(T.Item,{value:d.iso_2,children:d.display_name},d.iso_2))})]})}),e.jsx(t.ErrorMessage,{})]})})})]})]})},_s=()=>{const[s,r]=b.useState(!0),[n,l]=b.useState(""),[i,m]=b.useState(""),{t:a}=E(),{form:g,setCustomer:u}=z(),d=b.useCallback(as.debounce(h=>m(h),300),[]);b.useEffect(()=>(d(n),()=>d.cancel()),[n,d]);const{client:f}=ge(),{data:x,fetchNextPage:v,isFetchingNextPage:N}=Te(["customers",i],async({pageParam:h=0})=>await f.admin.customers.list({q:i,limit:10,offset:h,has_account:!0})),_=h=>{if(!h)return"";const{first_name:y,last_name:I,email:L}=h,D=[y,I].filter(Boolean).join(" ");return D?`${D} (${L})`:L},c=h=>{if(!h){u(null);return}const y=x==null?void 0:x.pages.flatMap(I=>I.customers).find(I=>I.id===h);if(!y)throw je({message:"Customer not found"},400);g.setValue("email",y.email,{shouldDirty:!0,shouldTouch:!0}),u(y)},j=(x==null?void 0:x.pages.flatMap(h=>h.customers.map(y=>({label:_(y),value:y.id}))))??[];return e.jsxs("div",{className:"flex flex-col gap-y-4",children:[e.jsx(se,{level:"h2",children:a("fields.customer")}),e.jsx("fieldset",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:s?e.jsx(t.Field,{control:g.control,name:"customer_id",render:({field:{onChange:h,...y}})=>e.jsxs(t.Item,{children:[e.jsx(t.Label,{className:"text-ui-fg-subtle !font-normal",children:a("fields.customer")}),e.jsx(t.Control,{children:e.jsx(ke,{...y,onChange:I=>{h(I),c(I)},searchValue:n,onSearchValueChange:l,fetchNextPage:v,isFetchingNextPage:N,options:j,autoComplete:"false"})}),e.jsx(t.ErrorMessage,{})]})},"customer-input"):e.jsx(t.Field,{control:g.control,name:"email",render:({field:h})=>e.jsxs(t.Item,{children:[e.jsx(t.Label,{className:"text-ui-fg-subtle !font-normal",children:a("fields.email")}),e.jsx(t.Control,{children:e.jsx(w,{...h})}),e.jsx(t.ErrorMessage,{})]})},"email-input")}),e.jsxs(Y,{className:"flex w-fit items-center gap-x-2",children:[e.jsx(ne,{checked:s,onCheckedChange:h=>r(!!h)}),e.jsx("span",{children:a("draftOrders.create.useExistingCustomerLabel")})]})]})},ys=()=>{const{t:s}=E(),{region:r,variants:n,custom:l,form:i,onOpenDrawer:m}=z(),{currency_code:a,currency:g}=r||{};return e.jsxs("div",{className:"flex flex-col gap-y-8",children:[e.jsx("fieldset",{className:"flex flex-col gap-y-4",children:e.jsx(t.Field,{control:i.control,name:"existing_items",render:({field:{name:u}})=>e.jsxs(t.Item,{className:"flex flex-col gap-y-4",children:[e.jsxs("div",{children:[e.jsx(t.Label,{children:s("draftOrders.create.existingItemsLabel")}),e.jsx(t.Hint,{children:s("draftOrders.create.existingItemsHint")})]}),n.items.length>0?n.items.map((d,f)=>e.jsxs("div",{className:"bg-ui-bg-component shadow-elevation-card-rest divide-y rounded-xl",children:[e.jsxs("div",{className:"flex items-center justify-between p-3",children:[e.jsxs("div",{className:"flex items-center gap-x-2",children:[e.jsx("div",{className:"shadow-borders-base size-fit overflow-hidden rounded-[4px]",children:e.jsx(Me,{src:d.thumbnail})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-x-1",children:[e.jsx(p,{size:"small",leading:"compact",weight:"plus",children:d.product_title}),d.sku&&e.jsxs(p,{size:"small",leading:"compact",className:"text-ui-fg-subtle",children:["(",d.sku,")"]})]}),e.jsx(p,{size:"small",leading:"compact",className:"text-ui-fg-subtle",children:d.variant_title})]})]}),e.jsxs("div",{className:"flex items-center gap-x-3",children:[e.jsx(p,{size:"small",leading:"compact",className:"text-ui-fg-subtle",children:De(d.unit_price,a)}),e.jsx(Se,{groups:[{actions:[{label:s("actions.remove"),onClick:()=>n.remove(f),icon:e.jsx(Ie,{})}]}]})]})]}),e.jsxs("fieldset",{className:"grid grid-cols-1 gap-3 p-3 md:grid-cols-2",children:[e.jsx(t.Field,{control:i.control,name:`${u}.${f}.quantity`,render:({field:{onChange:x,...v}})=>e.jsxs(t.Item,{children:[e.jsx(t.Label,{children:s("fields.quantity")}),e.jsx(t.Control,{children:e.jsx(w,{className:"!bg-ui-bg-field-component hover:!bg-ui-bg-field-component-hover",type:"number",onChange:N=>x(Number(N.target.value)),...v})})]})}),e.jsx(t.Field,{control:i.control,name:`${u}.${f}.custom_unit_price`,render:({field:{onChange:x,...v}})=>e.jsxs(t.Item,{children:[e.jsx(t.Label,{optional:!0,children:s("draftOrders.create.unitPriceOverrideLabel")}),e.jsx(t.Control,{children:e.jsx(ae,{className:"!bg-ui-bg-field-component hover:!bg-ui-bg-field-component-hover",code:a,symbol:g==null?void 0:g.symbol_native,onValueChange:x,...v})}),e.jsx(t.ErrorMessage,{})]})})]})]},d.ei_id)):e.jsx("div",{className:"flex items-center justify-center px-2 py-3",children:e.jsx(p,{size:"small",leading:"compact",className:"text-ui-fg-muted",children:s("draftOrders.create.noExistingItemsAddedLabel")})}),e.jsx("div",{className:"flex items-center justify-end",children:e.jsx(K,{content:s("draftOrders.create.chooseRegionTooltip"),showTooltip:!r,children:e.jsx(V,{disabled:!r,variant:"secondary",size:"small",type:"button",onClick:()=>m(ee.EXISTING_ITEMS),children:s("draftOrders.create.addExistingItemsAction")})})}),e.jsx(t.ErrorMessage,{})]})})}),e.jsx("div",{className:"md:grid-grid-cols-2 grid grid-cols-1 gap-3 p-3",children:e.jsx(t.Field,{control:i.control,name:"custom_items",render:({field:{name:u}})=>e.jsxs(t.Item,{className:"flex flex-col gap-y-4",children:[e.jsxs("div",{children:[e.jsx(t.Label,{children:s("draftOrders.create.customItemsLabel")}),e.jsx(t.Hint,{children:s("draftOrders.create.customItemsHint")})]}),l.items.length>0?l.items.map((d,f)=>e.jsxs("div",{className:"bg-ui-bg-component shadow-elevation-card-rest divide-y rounded-xl",children:[e.jsxs("div",{className:"flex items-center justify-between p-3",children:[e.jsx("div",{children:e.jsx("div",{className:"flex items-center gap-x-1",children:e.jsx(p,{size:"small",leading:"compact",weight:"plus",children:d.title})})}),e.jsx("div",{className:"flex items-center",children:e.jsx(Se,{groups:[{actions:[{label:s("actions.remove"),onClick:()=>l.remove(f),icon:e.jsx(Ie,{})}]}]})})]}),e.jsxs("fieldset",{className:"grid grid-cols-1 gap-3 p-3 md:grid-cols-2",children:[e.jsx(t.Field,{control:i.control,name:`${u}.${f}.quantity`,render:({field:x})=>e.jsxs(t.Item,{children:[e.jsx(t.Label,{children:s("fields.quantity")}),e.jsx(t.Control,{children:e.jsx(w,{className:"!bg-ui-bg-field-component hover:!bg-ui-bg-field-component-hover",type:"number",...x})})]})}),e.jsx(t.Field,{control:i.control,name:`${u}.${f}.unit_price`,render:({field:{onChange:x,...v}})=>e.jsxs(t.Item,{children:[e.jsx(t.Label,{children:s("fields.unitPrice")}),e.jsx(t.Control,{children:e.jsx(ae,{className:"!bg-ui-bg-field-component hover:!bg-ui-bg-field-component-hover",code:a,symbol:g==null?void 0:g.symbol_native,onValueChange:x,...v})})]})})]})]},d.ci_id)):e.jsx("div",{className:"flex items-center justify-center px-2 py-3",children:e.jsx(p,{size:"small",leading:"compact",className:"text-ui-fg-muted",children:s("draftOrders.create.noCustomItemsAddedLabel")})}),e.jsx("div",{className:"flex items-center justify-end",children:e.jsx(K,{content:s("draftOrders.create.chooseRegionTooltip"),showTooltip:!r,children:e.jsx(V,{variant:"secondary",size:"small",type:"button",disabled:!r,onClick:()=>m(ee.CUSTOM_ITEMS),children:s("draftOrders.create.addCustomItemAction")})})}),e.jsx(t.ErrorMessage,{})]})})})]})},Cs=()=>{const{t:s}=E(),{form:r,setRegion:n,variants:{rebase:l}}=z(),{client:i}=ge(),m=ts({control:r.control,name:"existing_items"}),{regions:a,isLoading:g,isError:u,error:d}=We({limit:1e3,fields:"id,name,currency_code"}),f=async _=>{if(!(m!=null&&m.length))return;const{variants:c}=await i.admin.variants.list({region_id:_,id:m.map(j=>j.variant_id)}).catch(j=>({variants:[]}));l(c)},x=()=>{r.resetField("shipping_method"),r.resetField("shipping_address"),r.resetField("billing_address")},v=_=>{const c=a==null?void 0:a.find(j=>j.id===_);if(!c)throw je({message:"Region not found"},400);n(c)},N=_=>async c=>{_(c),await f(c),x(),v(c)};if(u)throw d;return e.jsx("fieldset",{className:"grid grid-cols-2 gap-4",children:e.jsx(t.Field,{control:r.control,name:"region_id",render:({field:{ref:_,onChange:c,disabled:j,...h},fieldState:{error:y}})=>e.jsxs(t.Item,{children:[e.jsx(t.Label,{className:"!h2-core",children:s("fields.region")}),e.jsx(t.Hint,{children:s("draftOrders.create.chooseRegionHint")}),e.jsx(t.Control,{children:e.jsxs(T,{...h,onValueChange:N(c),disabled:g||j,children:[e.jsx(T.Trigger,{"aria-invalid":!!y,ref:_,children:e.jsx(T.Value,{})}),e.jsx(T.Content,{children:a==null?void 0:a.map(I=>e.jsx(T.Item,{value:I.id,children:I.name},I.id))})]})}),e.jsx(t.ErrorMessage,{})]})})})},Ns=()=>{const[s,r]=b.useState(""),[n,l]=b.useState(""),{t:i}=E(),{form:m,region:a}=z(),g=b.useCallback(ls(c=>l(c),300),[]);b.useEffect(()=>(g(s),()=>g.cancel()),[s,g]);const{client:u}=ge(),{data:d,fetchNextPage:f,isFetchingNextPage:x}=Te(["shipping_options",a==null?void 0:a.id,n],async({pageParam:c=0})=>await u.admin.shippingOptions.list({q:n||void 0,limit:10,offset:c,is_return:!1,region_id:a==null?void 0:a.id}),{getNextPageParam:c=>c.count>c.offset+c.limit?c.offset+c.limit:void 0,enabled:!!(a!=null&&a.id),keepPreviousData:!0}),v=c=>c?`${c.name} - ${M(c.amount||0,a==null?void 0:a.currency_code)}`:"",N=(d==null?void 0:d.pages.flatMap(c=>c.shipping_options).map(c=>({label:v(c),value:c.id})))||[],_=c=>{if(!c)return;const j=d==null?void 0:d.pages.flatMap(h=>h.shipping_options).find(h=>h.id===c);if(!j)throw je({message:"Shipping option not found"},400);m.setValue("shipping_method.option_title",j.name,{shouldDirty:!0,shouldTouch:!0}),m.setValue("shipping_method.amount",j.amount||0,{shouldDirty:!0,shouldTouch:!0})};return e.jsxs("div",{className:"flex flex-col gap-y-4",children:[e.jsx(se,{level:"h2",children:i("fields.shipping")}),e.jsxs("fieldset",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(t.Field,{control:m.control,name:"shipping_method.option_id",render:({field:{onChange:c,disabled:j,...h}})=>e.jsx(K,{showTooltip:!a,content:i("draftOrders.create.chooseRegionTooltip"),children:e.jsxs(t.Item,{children:[e.jsxs("div",{children:[e.jsx(t.Label,{children:i("draftOrders.create.shippingOptionLabel")}),e.jsx(t.Hint,{children:i("draftOrders.create.shippingOptionHint")})]}),e.jsx(t.Control,{children:e.jsx(ke,{...h,onChange:y=>{_(y),c(y)},disabled:!a||j,searchValue:s,onSearchValueChange:r,fetchNextPage:f,isFetchingNextPage:x,options:N,autoComplete:"false"})}),e.jsx(t.ErrorMessage,{})]})})}),e.jsx(t.Field,{control:m.control,name:"shipping_method.custom_amount",render:({field:{onChange:c,...j}})=>e.jsx(K,{showTooltip:!a,content:i("draftOrders.create.chooseRegionTooltip"),children:e.jsxs(t.Item,{children:[e.jsxs("div",{children:[e.jsx(t.Label,{optional:!0,children:i("draftOrders.create.shippingPriceOverrideLabel")}),e.jsx(t.Hint,{children:i("draftOrders.create.shippingPriceOverrideHint")})]}),e.jsx(t.Control,{children:a?e.jsx(ae,{...j,onValueChange:c,code:a.currency.code,symbol:a.currency.symbol_native}):e.jsx(w,{disabled:!0})}),e.jsx(t.ErrorMessage,{})]})})})]})]})},Ss=()=>{const{t:s}=E();return e.jsx("div",{className:"flex flex-col items-center p-16",children:e.jsxs("div",{className:"flex w-full max-w-[720px] flex-col gap-y-8",children:[e.jsxs("div",{children:[e.jsx(se,{children:s("draftOrders.create.createDraftOrder")}),e.jsx(p,{size:"small",className:"text-ui-fg-subtle",children:s("draftOrders.create.createDraftOrderHint")})]}),e.jsx(Cs,{}),e.jsx(k,{}),e.jsx(_s,{}),e.jsx(k,{}),e.jsx(ys,{}),e.jsx(k,{}),e.jsx(Ns,{}),e.jsx(k,{}),e.jsx(vs,{})]})})},Is=()=>{const{region:s,custom:r}=z(),{currency:n}=s||{},l=(n==null?void 0:n.code)||"",i=(n==null?void 0:n.symbol_native)||"",{t:m}=E(),[a,g]=b.useState({title:"",quantity:1,unit_price:void 0}),[u,d]=b.useState(null),f=()=>{const x=Ve.safeParse(a);if(!x.success){d(x.error);return}r.update(x.data)};return e.jsxs("div",{className:"flex size-full flex-col overflow-hidden",children:[e.jsx("div",{className:"size-full flex-1 overflow-auto px-6 py-4",children:e.jsxs("div",{className:"flex flex-col gap-y-4 [&>div]:flex [&>div]:flex-col [&>div]:gap-y-2",children:[e.jsxs("div",{children:[e.jsx(Y,{weight:"plus",size:"small",children:m("fields.title")}),e.jsx(w,{value:a.title,onChange:x=>g(v=>({...v,title:x.target.value}))}),e.jsx(he,{errors:u,field:"title"})]}),e.jsxs("div",{children:[e.jsx(Y,{weight:"plus",size:"small",children:m("fields.quantity")}),e.jsx(w,{value:a.quantity,type:"number",step:1,onChange:x=>{const v=O(x.target.value);g(N=>({...N,quantity:v}))}}),e.jsx(he,{errors:u,field:"quantity"})]}),e.jsxs("div",{children:[e.jsx(Y,{weight:"plus",size:"small",children:m("fields.unitPrice")}),e.jsx(ae,{code:l,symbol:i,value:a.unit_price,onValueChange:x=>{g(v=>({...v,unit_price:x}))}}),e.jsx(he,{errors:u,field:"unit_price"})]})]})}),e.jsxs("div",{className:"flex items-center justify-end gap-x-2 border-t p-4",children:[e.jsx(J.Close,{type:"button",asChild:!0,children:e.jsx(V,{variant:"secondary",size:"small",children:m("actions.cancel")})}),e.jsx(V,{size:"small",type:"button",onClick:f,children:m("actions.add")})]})]})},ws=(s,r)=>{if(!s)return null;const n=s.errors.find(l=>l.path[0]===r);return n?n.message:null},he=({field:s,errors:r})=>{const n=ws(r,s);return n?e.jsx(rs,{variant:"error",children:n}):null},pe=50,fe="av",Es=s=>s.reduce((r,n)=>(r[n.variant_id]=!0,r),{}),Os=()=>{const{region:s,customer:r,variants:n}=z(),{currency_code:l}=s||{},[i,m]=b.useState(Es(n.items)),[a,g]=b.useState(n.items),{t:u}=E(),{searchParams:d,raw:f}=us({pageSize:pe,prefix:fe}),{variants:x,count:v,isLoading:N,isError:_,error:c}=Je({region_id:s==null?void 0:s.id,customer_id:r==null?void 0:r.id,...d}),j=D=>{const P=typeof D=="function"?D(i):D,te=Object.keys(P).filter(C=>P[C]!==i[C]),re=((x==null?void 0:x.filter(C=>te.includes(C.id)))??[]).map(C=>{var q,H;return{variant_id:C.id,variant_title:C.title,unit_price:C.original_price,sku:C.sku??void 0,product_title:(q=C.product)==null?void 0:q.title,thumbnail:((H=C.product)==null?void 0:H.thumbnail)??void 0,quantity:1}});g(C=>{const q=C.filter(le=>Object.keys(P).includes(le.variant_id));return Array.from(new Set([...q,...re]))}),m(P)},h=()=>{n.update(a)},y=zs(),I=xs(),{table:L}=os({data:x||[],columns:y,count:v,pageSize:pe,enablePagination:!0,enableRowSelection:!0,getRowId:D=>D.id,rowSelection:{state:i,updater:j},meta:{currencyCode:l},prefix:fe});if(_)throw c;return e.jsxs("div",{className:"flex size-full flex-col overflow-hidden",children:[e.jsx(cs,{table:L,columns:y,count:v,isLoading:N,queryObject:f,pageSize:pe,filters:I,orderBy:["title","created_at","updated_at"],pagination:!0,search:!0,layout:"fill",prefix:fe}),e.jsxs("div",{className:"flex items-center justify-end gap-x-2 border-t p-4",children:[e.jsx(J.Close,{type:"button",asChild:!0,children:e.jsx(V,{variant:"secondary",size:"small",children:u("actions.cancel")})}),e.jsx(V,{size:"small",type:"button",onClick:h,children:u("actions.add")})]})]})},X=hs(),zs=()=>{const{t:s}=E();return b.useMemo(()=>[X.display({id:"select",header:({table:r})=>e.jsx(ne,{checked:r.getIsSomePageRowsSelected()?"indeterminate":r.getIsAllPageRowsSelected(),onCheckedChange:n=>r.toggleAllPageRowsSelected(!!n)}),cell:({row:r})=>e.jsx(ne,{checked:r.getIsSelected(),onCheckedChange:n=>r.toggleSelected(!!n)})}),X.accessor("product",{header:s("fields.product"),cell:({getValue:r})=>{const n=r();return n?e.jsx(ms,{product:n}):e.jsx(we,{})}}),X.accessor("options",{header:s("fields.variant"),cell:({getValue:r})=>{const n=r(),l=n==null?void 0:n.map(i=>i.value).join(" Â· ");return e.jsx("div",{className:"flex size-full items-center overflow-hidden",children:e.jsx("span",{className:"truncate",children:l})})}}),X.accessor("sku",{header:s("fields.sku"),cell:({getValue:r})=>{const n=r();return e.jsx("div",{className:"flex size-full items-center overflow-hidden",children:e.jsx("span",{className:"truncate",children:n??"-"})})}}),X.accessor("original_price",{header:()=>e.jsx("div",{className:"flex size-full items-center justify-end overflow-hidden text-right",children:e.jsx("span",{className:"truncate",children:s("fields.unitPrice")})}),cell:({getValue:r,table:n})=>{const l=r(),{currencyCode:i}=n.options.meta;return!l||!i?e.jsx(we,{}):e.jsx(ds,{align:"right",amount:l,currencyCode:i})}})],[s])},Ds=({view:s})=>{switch(s){case ee.EXISTING_ITEMS:return e.jsx(Os,{});case ee.CUSTOM_ITEMS:return e.jsx(Is,{});default:return null}},Ts=()=>{const{form:s,region:r}=z(),{currency_code:n}=r||{},l=s.getValues("custom_items")||[];return l.length?e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[l.map((i,m)=>{const a=i.unit_price?F(O(i.unit_price),n):i.unit_price,g=a*i.quantity;return e.jsxs("div",{className:"grid grid-cols-2 items-start gap-4",children:[e.jsx(p,{size:"small",leading:"compact",weight:"plus",className:"text-ui-fg-base",children:i.title}),e.jsxs("div",{className:"grid grid-cols-3 items-center gap-x-4",children:[e.jsx("div",{className:"flex items-center justify-end gap-x-2",children:e.jsx(p,{size:"small",children:M(a,n)})}),e.jsx("div",{className:"min-w-[27px] text-right",children:e.jsxs(p,{children:[e.jsx("span",{className:"tabular-nums",children:i.quantity}),"x"]})}),e.jsx("div",{className:"flex items-center justify-end",children:e.jsx(p,{size:"small",children:M(g,n)})})]})]},m)}),e.jsx(k,{variant:"dashed"})]}):null},ks=()=>{const{form:s,customer:r,sameAsShipping:n,region:l}=z(),{countries:i}=l||{},{t:m}=E(),a=s.getValues("shipping_address"),g=i==null?void 0:i.find(j=>j.iso_2===(a==null?void 0:a.country_code)),u=s.getValues("billing_address"),d=i==null?void 0:i.find(j=>j.iso_2===(u==null?void 0:u.country_code)),f=s.getValues("email"),x=(a==null?void 0:a.phone)||(u==null?void 0:u.phone)||(r==null?void 0:r.phone),{first_name:v,last_name:N}=r||a||{},_=[v,N].filter(Boolean).join(" "),c=_?_[0].toUpperCase():(f==null?void 0:f[0].toUpperCase())||"?";return e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-1 gap-2",children:[r&&e.jsxs("div",{className:"grid grid-cols-2",children:[e.jsx(p,{size:"small",leading:"compact",children:m("fields.id")}),e.jsxs("div",{className:"flex items-center gap-x-2",children:[e.jsx(Ye,{fallback:c,size:"2xsmall"}),e.jsx(p,{size:"small",leading:"compact",children:_||f})]})]}),e.jsxs("div",{className:"grid grid-cols-2",children:[e.jsx(p,{size:"small",leading:"compact",children:m("fields.email")}),e.jsx(p,{size:"small",leading:"compact",children:f})]}),e.jsxs("div",{className:"grid grid-cols-2",children:[e.jsx(p,{size:"small",leading:"compact",children:m("fields.phone")}),e.jsx(p,{size:"small",leading:"compact",children:x||"-"})]}),e.jsxs("div",{className:"grid grid-cols-2",children:[e.jsx(p,{size:"small",leading:"compact",children:m("addresses.shippingAddress.label")}),e.jsx(p,{size:"small",leading:"compact",children:Ee({address:{...a,country:g}}).map((j,h)=>e.jsxs("span",{className:"break-words",children:[j,e.jsx("br",{})]},h))})]}),e.jsxs("div",{className:"grid grid-cols-2",children:[e.jsx(p,{size:"small",leading:"compact",children:m("addresses.billingAddress.label")}),n?e.jsx(p,{size:"small",leading:"compact",className:"text-ui-fg-muted",children:m("addresses.billingAddress.sameAsShipping")}):e.jsx(p,{size:"small",leading:"compact",children:Ee({address:{...u,country:d}}).map((j,h)=>e.jsxs("span",{className:"break-words",children:[j,e.jsx("br",{})]},h))})]})]})},Ms=()=>{const{t:s}=E(),{form:r}=z();return e.jsx("div",{children:e.jsx(t.Field,{control:r.control,name:"notification_order",render:({field:{value:n,onChange:l,...i}})=>e.jsxs(t.Item,{children:[e.jsxs("div",{className:"flex flex-col gap-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(t.Label,{children:s("draftOrders.create.sendNotificationLabel")}),e.jsx(t.Control,{children:e.jsx(ps,{...i,onCheckedChange:l,checked:n})})]}),e.jsx(t.Hint,{children:s("draftOrders.create.sendNotificationHint")})]}),e.jsx(t.ErrorMessage,{})]})})})},Vs=()=>{const{t:s}=E(),{form:r,region:n}=z(),{currency_code:l}=n||{},i=r.getValues("existing_items")||[],m=i.reduce((N,_)=>{const c=Fs(_,l);return N+=c},0),a=r.getValues("custom_items")||[],g=a.reduce((N,_)=>{const c=Ls(_,l);return N+=c},0),u=i.length+a.length,d=m+g,f=r.getValues("shipping_method"),x=Ps(f,l),v=d+x;return e.jsxs("div",{className:"text-ui-fg-subtle flex flex-col gap-y-4",children:[e.jsxs("div",{className:"flex flex-col gap-y-2",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx(p,{size:"small",leading:"compact",children:s("fields.subtotal")}),e.jsx(p,{size:"small",leading:"compact",className:"text-right",children:s("general.items",{count:u})}),e.jsx(p,{size:"small",leading:"compact",className:"text-right",children:M(d,l)})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx(p,{size:"small",leading:"compact",children:s("fields.shipping")}),e.jsx(p,{size:"small",leading:"compact",className:"text-right",children:f.option_title}),e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[f.custom_amount&&e.jsx(p,{size:"small",className:"text-ui-fg-muted line-through",children:M(O(f.amount||0),l)}),e.jsx(p,{size:"small",leading:"compact",className:"text-right",children:M(x,l)})]})]})]}),e.jsx(k,{variant:"dashed"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(p,{size:"small",leading:"compact",children:s("fields.totalExclTax")}),e.jsx(p,{size:"small",leading:"compact",className:"text-right",children:De(v,l)})]})]})},Fs=(s,r)=>{if(s.custom_unit_price){const n=O(s.custom_unit_price);return F(n,r)*s.quantity}return s.unit_price*s.quantity},Ls=(s,r)=>F(O(s.unit_price),r)*s.quantity,Ps=(s,r)=>{if(s.custom_amount){const n=O(s.custom_amount);return F(n,r)}return s.amount?typeof s.amount=="string"?Number(s.amount.replace(",",".")):s.amount:0},As=()=>{const{form:s,region:r}=z(),{currency_code:n}=r||{},l=s.getValues("existing_items")||[];return l.length?e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[l.map(i=>{const m=i.custom_unit_price?F(O(i.custom_unit_price),n):i.unit_price,a=m*i.quantity;return e.jsxs("div",{className:"grid grid-cols-2 items-start gap-4",children:[e.jsxs("div",{className:"flex items-start gap-x-4",children:[e.jsx(Me,{src:i.thumbnail}),e.jsxs("div",{children:[e.jsx(p,{size:"small",leading:"compact",weight:"plus",className:"text-ui-fg-base",children:i.product_title}),i.sku&&e.jsxs("div",{className:"flex items-center gap-x-1",children:[e.jsx(p,{size:"small",children:i.sku}),e.jsx(fs,{content:i.sku,className:"text-ui-fg-muted"})]}),e.jsx(p,{size:"small",children:i.variant_title})]})]}),e.jsxs("div",{className:"grid grid-cols-3 items-center gap-x-4",children:[e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[i.custom_unit_price&&e.jsx(p,{size:"small",className:"text-ui-fg-muted line-through",children:M(i.unit_price,n)}),e.jsx(p,{size:"small",children:M(m,n)})]}),e.jsx("div",{className:"min-w-[27px] text-right",children:e.jsxs(p,{children:[e.jsx("span",{className:"tabular-nums",children:i.quantity}),"x"]})}),e.jsx("div",{className:"flex items-center justify-end",children:e.jsx(p,{size:"small",children:M(a,n)})})]})]},i.variant_id)}),e.jsx(k,{variant:"dashed"})]}):null},qs=()=>{const{t:s}=E();return e.jsx("div",{className:"flex size-full flex-col items-center overflow-auto p-16",children:e.jsxs("div",{className:"flex w-full max-w-[720px] flex-col gap-y-8",children:[e.jsx(se,{children:s("fields.summary")}),e.jsx(ks,{}),e.jsxs("div",{className:"flex flex-col gap-y-4",children:[e.jsx(k,{variant:"dashed"}),e.jsx(As,{}),e.jsx(Ts,{}),e.jsx(Vs,{}),e.jsx(k,{variant:"dashed"})]}),e.jsx(Ms,{})]})})},Rs=()=>{const[s,r]=b.useState(!1),[n,l]=b.useState(null),[i,m]=b.useState("details"),[a,g]=b.useState(!1),[u,d]=b.useState(null),[f,x]=b.useState(null),[v,N]=b.useState(!0),{t:_}=E(),[,c]=ns(),{handleSuccess:j}=es(),h=is({defaultValues:{email:"",region_id:"",shipping_method:{amount:"",custom_amount:"",option_id:"",option_title:""},shipping_address:{address_1:"",address_2:"",city:"",company:"",country_code:"",first_name:"",last_name:"",phone:"",postal_code:"",province:""},billing_address:null,existing_items:[],custom_items:[],customer_id:"",notification_order:!0},resolver:ss(bs)}),{clearErrors:y,formState:{isDirty:I}}=h,{append:L,remove:D,fields:P}=Ne({control:h.control,name:"custom_items",keyName:"ci_id"}),{append:te,remove:$,update:re,fields:C}=Ne({control:h.control,name:"existing_items",keyName:"ei_id"}),{mutateAsync:q,isLoading:H}=Ke(),le=h.handleSubmit(async S=>{let{shipping_address:U,billing_address:A,existing_items:Q,custom_items:oe,shipping_method:ce,email:Re,notification_order:$e,...He}=S;const Ce=Re||(f==null?void 0:f.email);if(!Ce){h.setError("email",{type:"manual",message:"Email is required"}),h.setError("customer_id",{type:"manual",message:"Customer is required"});return}A||(A=U);const Ue=(Q==null?void 0:Q.map(Z=>{const{custom_unit_price:de,variant_id:me,quantity:ue}=Z,B=Number(de),xe=isNaN(B)?void 0:F(B,u==null?void 0:u.currency_code);return{variant_id:me,quantity:ue,unit_price:xe}}))||[],Qe=(oe==null?void 0:oe.map(Z=>{const{unit_price:de,quantity:me,title:ue}=Z,B=O(de),xe=isNaN(B)?void 0:F(B,u==null?void 0:u.currency_code);return{title:ue,quantity:me,unit_price:xe}}))||[],Ze=[...Ue,...Qe],Be=[{option_id:ce.option_id,price:ce.custom_amount?F(O(ce.custom_amount),u==null?void 0:u.currency_code):void 0}];await q({...He,email:Ce,shipping_address:U,billing_address:A,items:Ze,shipping_methods:Be,no_notification_order:!$e},{onSuccess:({draft_order:Z})=>{j(`../${Z.id}`)}})}),ie=b.useCallback(()=>{y("custom_items"),y("existing_items")},[y]),be=b.useCallback(S=>{$s(S,C,$,te,"variant_id"),l(null),r(!1),ie()},[te,$,C,ie]),ve=b.useCallback(S=>{L(S),l(null),r(!1),ie()},[L,ie]),Le=S=>{l(S),r(!0)},Pe=S=>{S||(l(null),c({},{replace:!0})),r(S)},_e=h.handleSubmit(()=>{m("summary"),g(!0)}),ye=b.useCallback(S=>{if(S.length)for(const U of S){const A=C.findIndex(Q=>Q.variant_id===U.id);A!==-1&&re(A,{...C[A],unit_price:U.original_price})}},[re,C]),Ae=S=>{switch(S){case"details":g(!1),m(S);break;case"summary":_e();break}},qe=b.useMemo(()=>a?"completed":I?"in-progress":"not-started",[a,I]);return e.jsx(Fe.Provider,{value:b.useMemo(()=>({custom:{items:P,remove:D,update:ve},variants:{items:C,remove:$,update:be,rebase:ye},form:h,region:u,setRegion:d,customer:f,setCustomer:x,sameAsShipping:v,setSameAsShipping:N,onOpenDrawer:Le}),[P,D,ve,C,$,be,ye,h,f,u,v]),children:e.jsx(W.Form,{form:h,children:e.jsx("form",{className:"flex h-full flex-col overflow-hidden",onSubmit:le,children:e.jsxs(R,{value:i,onValueChange:S=>Ae(S),className:"flex h-full flex-col overflow-hidden",children:[e.jsx(W.Header,{children:e.jsxs("div",{className:"flex w-full items-center justify-between gap-x-4",children:[e.jsx("div",{className:"-my-2 w-full max-w-[400px] border-l",children:e.jsxs(R.List,{className:"grid w-full grid-cols-2",children:[e.jsx(R.Trigger,{className:"w-full",value:"details",status:qe,children:_("fields.details")}),e.jsx(R.Trigger,{className:"w-full",value:"summary",children:_("fields.summary")})]})}),e.jsxs("div",{className:"flex items-center gap-x-2",children:[e.jsx(W.Close,{asChild:!0,children:e.jsx(V,{variant:"secondary",size:"small",children:_("actions.cancel")})}),i==="summary"?e.jsx(V,{type:"submit",size:"small",isLoading:H,children:_("actions.save")},"save-btn"):e.jsx(V,{type:"button",onClick:_e,size:"small",children:_("actions.continue")},"continue-btn")]})]})}),e.jsxs(W.Body,{className:"size-full overflow-hidden",children:[e.jsx(R.Content,{value:"details",className:"size-full overflow-hidden",children:e.jsxs(J,{open:s,onOpenChange:Pe,children:[e.jsx(J.Content,{children:e.jsx(Ss,{})}),e.jsx(J.Drawer,{children:e.jsx(Ds,{view:n})})]})}),e.jsx(R.Content,{value:"summary",className:"flex h-full w-full flex-col items-center overflow-hidden",children:e.jsx(qs,{})})]})]})})})})},$s=(s,r,n,l,i)=>{const m=s.map(d=>d[i]),a=r.map(d=>d[i]),g=r.reduce((d,f,x)=>(m.includes(f[i])||d.push(x),d),[]),u=s.filter(d=>!a.includes(d[i]));n(g),l(u)},Zt=()=>e.jsx(W,{children:e.jsx(Rs,{})});export{Zt as Component};
